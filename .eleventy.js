// imports
const eleventyNavigationPlugin = require("@11ty/eleventy-navigation");
const { DateTime } = require("luxon");

module.exports = function (eleventyConfig) {
  // adds the official eleventy navigation plugin for a scalable navigation
  eleventyConfig.addPlugin(eleventyNavigationPlugin);

  // allows assets, CMS files and other root files to be passed into /public. styles are automatically generated by LESS/SASS
  eleventyConfig.addPassthroughCopy("./src/assets");
  eleventyConfig.addPassthroughCopy("./src/admin");
  eleventyConfig.addPassthroughCopy("./src/_redirects");
  eleventyConfig.addPassthroughCopy({ "./src/robots.txt": "/robots.txt" });
  eleventyConfig.addPassthroughCopy({ "./src/sitemap.xml": "/sitemap.xml" });
  eleventyConfig.addPassthroughCopy({ "./src/ads.txt": "/ads.txt" });
  eleventyConfig.addPassthroughCopy({
    "./src/BingSiteAuth.xml": "/BingSiteAuth.xml",
  });

  // normally, 11ty will render dates on blog posts in full JSDate format (Fri Dec 02 18:00:00 GMT-0600)
  // this filter allows dates to be converted into a normal, locale format. view the docs to learn more (https://moment.github.io/luxon/api-docs/index.html#datetime)
  eleventyConfig.addFilter("postDate", (dateObj) => {
    return DateTime.fromJSDate(dateObj).toLocaleString(DateTime.DATE_MED);
  });

  //Date filter Rss
  eleventyConfig.addFilter("dateToRfc3339", (dateObj) => {
    return DateTime.fromJSDate(dateObj, { zone: "utc" }).toFormat(
      "yyyy-LL-dd'T'HH:mm:ss.SSSZZ",
    );
  });

  // Sanitize Slug
  const slugify = require("slugify");

  eleventyConfig.addFilter("sanitizeSlug", function (value) {
    return slugify(value, {
      remove: /[^a-zA-Z0-9-_ ]/g, // regex to remove unwanted characters
      lower: true, // convert to lower case
      replacement: "-", // replace spaces with replacement
    });
  });

  eleventyConfig.addNunjucksFilter("isExternal", function (url) {
    return url.startsWith("http://") || url.startsWith("https://");
  });

  return {
    dir: {
      input: "src",
      output: "public",
      includes: "_includes",
      data: "_data",
    },
    htmlTemplateEngine: "njk",
  };
};
